<!DOCTYPE html>
<html lang="zh-cn">
        <head>
                        <meta charset="utf-8" />
                        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                        <meta name="generator" content="Pelican" />
                        <title>ShaoDJ's World - selenium</title>
                        <link rel="stylesheet" href="https://shaodongjun.github.io/theme/css/main.css" />
                                <link href="https://shaodongjun.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="ShaoDJ's World Atom Feed" />
                                <link href="https://shaodongjun.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="ShaoDJ's World RSS Feed" />
        </head>

        <body id="index" class="home">
                <header id="banner" class="body">
                        <h1><a href="https://shaodongjun.github.io/">ShaoDJ's World</a></h1>
                        <nav><ul>
                                                <li><a href="https://shaodongjun.github.io/category/bian-cheng.html">编程</a></li>
                                                <li><a href="https://shaodongjun.github.io/category/ren-gong-zhi-neng.html">人工智能</a></li>
                                                <li><a href="https://shaodongjun.github.io/category/yun-wei.html">运维</a></li>
                                                <li><a href="https://shaodongjun.github.io/category/za-ji.html">杂记</a></li>
                        </ul></nav>
                </header><!-- /#banner -->

                <aside id="featured" class="body">
                    <article>
                        <h1 class="entry-title"><a href="https://shaodongjun.github.io/posts/2025/02/04/python-selenium-web/">使用 Selenium <span class="amp">&amp;</span> webdriver&nbsp;自动化测试</a></h1>
<footer class="post-info">
        <abbr class="published" title="2025-02-04T14:08:00+08:00">
                Published: 二 04 二月 2025
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="https://shaodongjun.github.io/author/djshao.html">DJ.shao</a>
                </address>
        <p>In <a href="https://shaodongjun.github.io/category/bian-cheng.html">编程</a>.</p>
<p>tags: <a href="https://shaodongjun.github.io/tag/blog.html">blog</a> <a href="https://shaodongjun.github.io/tag/python.html">python</a> <a href="https://shaodongjun.github.io/tag/selenium.html">selenium</a> <a href="https://shaodongjun.github.io/tag/web.html">web</a> </p>        
</footer><!-- /.post-info --><p><strong>Selenium</strong> 是 Python 生态中最强大的工具之一，特别适合处理动态网页和复杂用户交互场景。无论是用于自动化测试、数据抓取、还是 Web&nbsp;爬虫、任务自动化（如表单提交、网页截图、数据抓取等），<code>Selenium</code> 都是一个优秀的选择。</p>
<h2>Selenium&nbsp;的一些优秀特性和用途：</h2>
<hr>
<h2>1.&nbsp;跨浏览器支持</h2>
<p>Selenium&nbsp;支持多种浏览器，包括：</p>
<ul>
<li>
<p><strong>Chrome</strong>（通过&nbsp;ChromeDriver）</p>
</li>
<li>
<p><strong>Edge</strong>（通过&nbsp;EdgeDriver）</p>
</li>
<li>
<p><strong>Firefox</strong>（通过&nbsp;GeckoDriver）</p>
</li>
<li>
<p><strong>Safari</strong>（通过&nbsp;SafariDriver）</p>
</li>
<li>
<p><strong>Opera</strong>&nbsp;等。</p>
</li>
</ul>
<p>这使得 Selenium&nbsp;可以在不同的浏览器环境中运行相同的脚本，确保兼容性。</p>
<h2>2.&nbsp;支持多种编程语言</h2>
<p>Selenium 不仅支持&nbsp;Python，还支持：</p>
<ul>
<li>
<p>Java</p>
</li>
<li>
<p>JavaScript&nbsp;(Node.js)</p>
</li>
<li>
<p>C#</p>
</li>
<li>
<p>Ruby</p>
</li>
<li>
<p><span class="caps">PHP</span>&nbsp;等。</p>
</li>
</ul>
<p>这使得开发者可以使用自己熟悉的语言来编写自动化脚本。</p>
<h2>3.&nbsp;强大的元素定位功能</h2>
<p>Selenium&nbsp;提供了多种定位网页元素的方式，例如：</p>
<ul>
<li>
<p><strong>By <span class="caps">ID</span></strong>: <code>find_element(By.ID, "element_id")</code></p>
</li>
<li>
<p><strong>By Class Name</strong>: <code>find_element(By.CLASS_NAME, "class_name")</code></p>
</li>
<li>
<p><strong>By Name</strong>: <code>find_element(By.NAME, "name")</code></p>
</li>
<li>
<p><strong>By Tag Name</strong>: <code>find_element(By.TAG_NAME, "tag_name")</code></p>
</li>
<li>
<p><strong>By <span class="caps">CSS</span> Selector</strong>: <code>find_element(By.CSS_SELECTOR, "css_selector")</code></p>
</li>
<li>
<p><strong>By XPath</strong>: <code>find_element(By.XPATH, "xpath_expression")</code></p>
</li>
</ul>
<p>这些定位方式使得 Selenium&nbsp;可以灵活地与网页中的任何元素交互。</p>
<h2>4.&nbsp;丰富的操作功能</h2>
<p>Selenium&nbsp;不仅可以点击按钮、输入文本，还可以：</p>
<ul>
<li>提交表单</li>
<li>处理下拉菜单</li>
<li>上传文件</li>
<li>执行 JavaScript&nbsp;代码</li>
<li>截图</li>
<li>处理弹窗（如警告框、确认框）</li>
<li>切换窗口或&nbsp;iframe</li>
</ul>
<p>这些功能使得 Selenium&nbsp;可以模拟几乎所有的用户操作。</p>
<h2>5.&nbsp;支持动态网页</h2>
<p>Selenium 可以处理 JavaScript&nbsp;动态加载的内容，这是它与传统爬虫工具（如 <code>requests</code> 库）相比的最大优势。它能够等待页面完全加载后再进行操作，甚至可以与动态生成的元素交互。</p>
<h2>6. 支持无头模式（Headless&nbsp;Mode）</h2>
<p>通过启用无头模式（如 <code>options.add_argument('headless')</code>），Selenium 可以在后台运行浏览器，无需打开 <span class="caps">GUI</span>&nbsp;界面。这对于服务器环境或自动化任务非常有用，可以节省资源并提高效率。</p>
<h2>7.&nbsp;强大的等待机制</h2>
<p>Selenium&nbsp;提供了两种等待机制来处理异步加载的内容：</p>
<ul>
<li><strong>隐式等待（Implicit Wait）</strong>：全局等待时间，适用于所有元素。</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">driver</span><span class="o">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># 等待最多 10 秒</span>
</code></pre></div>

<ul>
<li><strong>显式等待（Explicit Wait）</strong>：针对特定条件等待，直到条件满足或超时。</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>

<span class="n">element</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
    <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;element_id&quot;</span><span class="p">))</span>
<span class="p">)</span>
</code></pre></div>

<h2>8.&nbsp;支持分布式测试</h2>
<p>通过 Selenium&nbsp;Grid，可以在多台机器上并行运行测试脚本，显著提高测试效率。</p>
<h2>9.&nbsp;社区支持和文档丰富</h2>
<p>Selenium&nbsp;拥有庞大的用户社区和丰富的文档资源，遇到问题时可以轻松找到解决方案。</p>
<h2>10.&nbsp;应用场景广泛</h2>
<p>Selenium&nbsp;不仅用于测试，还可以用于：</p>
<ul>
<li>
<p>Web&nbsp;爬虫：抓取动态加载的数据。</p>
</li>
<li>
<p>自动化任务：如自动填写表单、自动登录、自动下载文件等。</p>
</li>
<li>
<p>网页监控：定期检查网页内容变化。</p>
</li>
<li>
<p>性能测试：模拟用户操作，测试网页性能。</p>
</li>
</ul>
<h2>11.&nbsp;与其他工具集成</h2>
<p>Selenium&nbsp;可以与其他工具和框架集成，例如：</p>
<ul>
<li>
<p>Pytest：用于编写更结构化的测试脚本。</p>
</li>
<li>
<p>BeautifulSoup：用于解析抓取的网页内容。</p>
</li>
<li>
<p>Pandas：用于处理和分析抓取的数据。</p>
</li>
<li>
<p>Docker：用于在容器化环境中运行&nbsp;Selenium。</p>
</li>
</ul>
<h2>12.&nbsp;开源和免费</h2>
<p>Selenium&nbsp;是一个开源项目，完全免费使用，适合个人和企业。</p>
<hr>
<h1>使用Selenium v4&nbsp;编写脚本</h1>
<h2>预约球场</h2>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.edge.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.edge.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>

<span class="c1"># 设置 Edge 选项</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">options</span><span class="o">.</span><span class="n">use_chromium</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># This is required for Selenium 4</span>
<span class="n">options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;headless&#39;</span><span class="p">)</span>  <span class="c1"># 运行无界面模式</span>
<span class="n">options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-gpu&#39;</span><span class="p">)</span>  <span class="c1"># 可选：禁用 GPU 硬件加速</span>
<span class="n">options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--window-size=1920,1080&#39;</span><span class="p">)</span>  <span class="c1"># 可选：设置窗口大小</span>

<span class="c1"># 初始化 WebDriver 服务</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;C:\chromedriver.exe&#39;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">daytime</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">day</span><span class="p">))</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()</span>
        <span class="n">daytime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">daytime</span><span class="p">))</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://xihuwenti.juyancn.cn/wechat/product/details?id=753&amp;time=</span><span class="si">{</span><span class="n">daytime</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="c1"># 等待元素加载</span>
        <span class="n">elems</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_all_elements_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s1">&#39;can-select&#39;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elems</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;data-start&#39;</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;data-end&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">start_time</span> <span class="o">==</span> <span class="s2">&quot;12:00&quot;</span> <span class="ow">or</span> <span class="n">end_time</span> <span class="o">==</span> <span class="s2">&quot;18:00&quot;</span><span class="p">:</span>
                <span class="n">hall_name</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;data-hall_name&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">hall_name</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
  <span class="k">raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="k">finally</span><span class="p">:</span>
  <span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</code></pre></div>                    </article>
                </aside><!-- /#featured -->
                <section id="extras" class="body">
                                <div class="blogroll">
                                        <h2>links</h2>
                                        <ul>
                                                        <li><a href="https://www.upyun.com">UP#AI</a></li>
                                        </ul>
                                </div><!-- /.blogroll -->
                                <div class="social">
                                        <h2>social</h2>
                                        <ul>
                                                        <li><a href="https://shaodongjun.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                                                        <li><a href="https://shaodongjun.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">rss feed</a></li>

                                        </ul>
                                </div><!-- /.social -->
                </section><!-- /#extras -->

                <footer id="contentinfo" class="body">
                        <address id="about" class="vcard body">
                                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                        </address><!-- /#about -->

                        <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
                </footer><!-- /#contentinfo -->

        </body>
</html>